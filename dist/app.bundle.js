(()=>{let e,t,o;async function n(){try{const e=await o.methods.getDoctorsWithAccess().call(),t=e[0],n=e[1],c=document.getElementById("doctor-list");c.innerHTML="",t.forEach(((e,t)=>{const o=c.insertRow();o.insertCell(0).textContent=t+1,o.insertCell(1).textContent=e,o.insertCell(2).textContent=n[t],o.insertCell(3).textContent="✅"}))}catch(e){console.error("Erreur lors du chargement des médecins :",e)}}void 0!==window.ethereum?console.log("MetaMask trouvé !"):alert("Veuillez installer MetaMask !"),document.getElementById("grant-access").addEventListener("click",(async function(){const e=document.getElementById("doctorAddress").value,c=document.getElementById("doctorName").value;try{const n=await t.eth.getAccounts();await o.methods.grantAccess(e,86400,c,[]).send({from:n[0]}),alert(`Accès accordé au médecin ${e} pour 24 heures`)}catch(e){console.error("Erreur lors de l'attribution de l'accès :",e),alert("Erreur lors de l'attribution de l'accès.")}await n()})),document.getElementById("loadDoctors").addEventListener("click",n),document.getElementById("check-access").addEventListener("click",(async function(){try{const e=await t.eth.getAccounts();console.log("Compte déployeur :",e[0]);const n="0x71bE63f3384f5fb98995898A86B02Fb2426c5788",c=await o.methods.canAccess(n).call();console.log(`Le médecin ${n} a accès ?`,c)}catch(e){console.error("Erreur lors de la vérification de l'état du contrat :",e)}})),window.onload=async function(){const c=document.getElementById("ifNotLogging"),r=document.getElementById("ifLogging");try{await async function(){try{const t=await fetch("/contract.json"),o=await t.json();e=o.abi,console.log("ABI chargé :",e)}catch(e){console.error("Erreur lors du chargement de l'ABI :",e),alert("Erreur lors du chargement de l'ABI. Vérifiez votre configuration.")}}(),t=new Web3(window.ethereum),await ethereum.request({method:"eth_requestAccounts"}),o=new t.eth.Contract(e,"0x5FbDB2315678afecb367f032d93F642f64180aa3"),console.log("Contrat initialisé !"),c.style.display="none",r.style.display="block"}catch(e){console.error("Erreur d'initialisation",e)}await n()}})();