(()=>{let e,t,o;void 0!==window.ethereum?console.log("MetaMask trouvé !"):alert("Veuillez installer MetaMask !"),document.getElementById("requestAccessButton").addEventListener("click",(async function(){try{const e=(await t.eth.getAccounts())[0],n=document.getElementById("doctorAddress").value,s=3600,r=await o.methods.grantAccess(n,s,"docteur",[]).send({from:e});console.log("Demande soumise :",r),document.getElementById("responseMessage").textContent="Accès accordé avec succès.",document.getElementById("responseMessage").style.color="green"}catch(e){console.error("Erreur lors de la soumission :",e),document.getElementById("responseMessage").textContent="Erreur lors de la soumission.",document.getElementById("responseMessage").style.color="red"}})),window.onload=async function(){try{await async function(){try{const t=await fetch("/contract.json"),o=await t.json();e=o.abi,console.log("ABI chargé :",e)}catch(e){console.error("Erreur lors du chargement de l'ABI :",e),alert("Erreur lors du chargement de l'ABI. Vérifiez votre configuration.")}}(),t=new Web3(window.ethereum),await ethereum.request({method:"eth_requestAccounts"}),o=new t.eth.Contract(e,"0x5FbDB2315678afecb367f032d93F642f64180aa3"),console.log("Contrat initialisé !")}catch(e){console.error("Erreur d'initialisation",e)}}})();